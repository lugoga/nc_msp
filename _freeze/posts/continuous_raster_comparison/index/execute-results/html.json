{
  "hash": "efb1840b330fd3963d6ad7fec8f0894f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Comparing Continuous Ecosystem Health Metrics: Temporal Changes in Mkoani and Mkuranga\"\ndescription: \"Methods for comparing continuous raster data between baseline (2020) and current (2023) ecosystem health indices\"\nauthor: \n  - name: Masumbuko Semba\n    affiliation: \"NM-AIST\"\n  - name: Siajali Pamba\n    affiliation: \"NM-AIST\"\ndate: \"2025-12-27\"\ncategories: [\"Spatial Analysis\", \"Ecosystem Monitoring\", \"Raster Comparison\", \"Temporal Change\"]\nimage: \"workflows.png\"\nexecute: \n  eval: false\n---\n\n\n\n\n## Introduction\n\nMonitoring ecosystem health across time requires robust methods for comparing continuous raster data—such as productivity indices, chlorophyll concentrations, or habitat quality scores—between different time periods. This article presents practical approaches for comparing continuous ecosystem health metrics between our baseline assessment (2020) and current monitoring (2023) in Mkoani and Mkuranga.\n\nThe methods shown here move beyond simple visual inspection to quantify how ecosystem health has changed across both spatial and temporal dimensions. Understanding these changes enables evidence-based adaptive management decisions for marine spatial planning.\n\n### Data Types\n\nThis tutorial uses continuous ecosystem health indices for Mkoani and Mkuranga:\n- **Baseline data (2020)**: NDVI-derived productivity index from ESA remote sensing\n- **Current data (2023)**: Ecosystem health index from latest field surveys and satellite data\n- **Temporal comparison**: Detecting areas of improvement vs. degradation\n- **Spatial patterns**: Understanding spatial autocorrelation of changes\n\n## Non-Spatial Methods\n\nNon-spatial approaches treat each cell independently, without considering surrounding values.\n\n### Single Cell Differences\n\nThe simplest approach is to calculate the difference between two rasters for each cell:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(terra)\n\n# Load ecosystem health indices for Mkoani and Mkuranga\nmkoani_2020 = rast(\"ecosystem_health_mkoani_2020.tif\")  # Baseline\nmkoani_2023 = rast(\"ecosystem_health_mkoani_2023.tif\")  # Current\n\n# Calculate the difference\nmkoani_diff = mkoani_2023 - mkoani_2020\n\n# Positive values = improvement, negative values = degradation\nplot(mkoani_diff, main = \"Ecosystem Health Change in Mkoani (2020-2023)\")\n```\n:::\n\n\n\n\nFor better visualization with diverging colors (where zero = no change):\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_div = function(r, ...){\n  r_range = range(values(r), na.rm = TRUE, finite = TRUE)\n  max_abs = max(abs(r_range))\n  new_range = c(-max_abs, max_abs)\n  plot(r, col = hcl.colors(100, palette = \"prgn\"), range = new_range, ...)\n}\n\nplot_div(mkoani_diff, main = \"Ecosystem Health Change: Green = Improvement\")\n```\n:::\n\n\n\n\n**Interpretation**: \n- **Positive values (green)**: Areas where ecosystem health has improved from 2020 to 2023\n- **Negative values (magenta)**: Areas where ecosystem health has degraded\n- **Near-zero values (yellow)**: Areas with stable ecosystem health\n\n### Distribution of Changes\n\nUnderstanding the distribution of changes across the landscape helps identify systematic trends:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(mkoani_diff, main = \"Distribution of Ecosystem Health Changes in Mkoani\",\n     xlab = \"Change Index (2023 - 2020)\", ylab = \"Number of Cells\")\n\n# Calculate summary statistics\nsummary(mkoani_diff)\n```\n:::\n\n\n\n\n### Error Metrics: Quantifying Overall Difference\n\nBeyond individual cell changes, we calculate metrics that summarize the overall difference between baseline and current ecosystem states.\n\n**Root Mean Square Error (RMSE)** quantifies average difference:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(yardstick)\n\n# RMSE calculation\nmkoani_rmse = rmse_vec(values(mkoani_2023)[, 1], values(mkoani_2020)[, 1])\nmkoani_rmse\n```\n:::\n\n\n\n\n**Mean Absolute Difference (MAD)** is less sensitive to outliers:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(diffeR)\n\nmkoani_mad = MAD(mkoani_2023, mkoani_2020)\nmkoani_mad$Total\n```\n:::\n\n\n\n\n**Interpretation Example**:\n- RMSE = 0.15: Average ecosystem health change is 0.15 units\n- MAD = 0.12: Median change magnitude is 0.12 units (more robust to outliers)\n\nThese metrics help compare different regions or time periods quantitatively.\n\n## Spatial Methods\n\nSpatial approaches incorporate neighborhood relationships—the idea that ecosystem changes in one location are influenced by surrounding areas.\n\n### Focal Correlation: Local Pattern Similarity\n\nThe `focalPairs()` function calculates correlation between moving windows of two rasters, revealing how similar local ecosystem patterns are:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compare local ecosystem patterns between 2020 and 2023\n# 5x5 window (50m × 50m with 10m resolution data)\nmkoani_cor = terra::focalPairs(c(mkoani_2023, mkoani_2020), \n                               w = 5,\n                               fun = \"pearson\", \n                               na.rm = TRUE)\n\nplot_div(mkoani_cor, main = \"Local Ecosystem Pattern Similarity (r)\")\n```\n:::\n\n\n\n\n**Interpretation**:\n- **Values near +1** (green): Local ecosystem patterns are highly similar—changes are gradual\n- **Values near 0** (yellow): No relationship between 2020 and 2023 local patterns—potential abrupt shifts\n- **Values near -1** (magenta): Inverse relationship—significant pattern transformation\n\n### Surface Roughness Change\n\nSurface roughness measures spatial heterogeneity—how much ecosystem health varies within local neighborhoods:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(geodiv)\n\nwindow = matrix(1, nrow = 5, ncol = 5)\n\n# Calculate surface roughness for both years\nmkoani_2020_sa = geodiv::focal_metrics(mkoani_2020, \n                                       window = window,\n                                       metric = \"sa\", \n                                       progress = FALSE)\n\nmkoani_2023_sa = geodiv::focal_metrics(mkoani_2023, \n                                       window = window,\n                                       metric = \"sa\", \n                                       progress = FALSE)\n\n# Difference in roughness\nmkoani_sa_diff = mkoani_2023_sa$sa - mkoani_2020_sa$sa\n\nplot_div(mkoani_sa_diff, \n         main = \"Change in Ecosystem Heterogeneity\\n(Positive = More Variable Health)\")\n```\n:::\n\n\n\n\n**Interpretation**:\n- **Positive values (green)**: Ecosystem health is becoming more variable—potential patchiness increasing\n- **Negative values (magenta)**: Ecosystem becoming more homogeneous—potentially homogenizing pressures\n- Management implication: High variability in small areas may require targeted interventions\n\n### Texture Homogeneity\n\nGLCM (Gray-Level Co-occurrence Matrix) texture homogeneity characterizes spatial structure:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(GLCMTextures)\n\n# Calculate texture homogeneity (smoothness of transitions)\nmkoani_2020_hom = GLCMTextures::glcmTexture(mkoani_2020, \n                                            window = 5, \n                                            metrics = \"homogeneity\")\n\nmkoani_2023_hom = GLCMTextures::glcmTexture(mkoani_2023, \n                                            window = 5, \n                                            metrics = \"homogeneity\")\n\nmkoani_hom_diff = mkoani_2023_hom - mkoani_2020_hom\n\nplot_div(mkoani_hom_diff, \n         main = \"Change in Ecosystem Texture Smoothness\\n(Positive = Smoother Transitions)\")\n```\n:::\n\n\n\n\n### Rao's Quadratic Entropy\n\nRao's Q measures diversity while accounting for dissimilarity between ecosystem states:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rasterdiv)\n\n# Convert to integer scale (multiply by 100)\nmkoani_2020_int = as.int(mkoani_2020 * 100)\nmkoani_2023_int = as.int(mkoani_2023 * 100)\n\n# Calculate Rao's Q (computational intensity: ~5-10 minutes)\nmkoani_2020_rao = rasterdiv::paRao(mkoani_2020_int, window = 5, progBar = FALSE)\nmkoani_2023_rao = rasterdiv::paRao(mkoani_2023_int, window = 5, progBar = FALSE)\n\n# Extract difference\nmkoani_rao_diff = mkoani_2023_rao[[1]][[1]] - mkoani_2020_rao[[1]][[1]]\n\nplot_div(mkoani_rao_diff, \n         main = \"Change in Ecosystem Diversity\\n(Positive = More Diverse Health Patterns)\")\n```\n:::\n\n\n\n\n**Interpretation**: Higher Rao's Q values indicate greater ecosystem diversity within local areas—potentially reflecting multiple habitat types or species communities.\n\n### Spatial Autocorrelation of Changes\n\nSpatial autocorrelation shows whether ecosystem changes are clustered or random:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate Moran's I for the change raster\nmkoani_diff_autocor = terra::autocor(mkoani_diff, method = \"moran\", global = FALSE)\n\n# Compare original difference and its spatial autocorrelation\npar(mfrow = c(1, 2))\nplot_div(mkoani_diff, main = \"Ecosystem Health Change\")\nplot_div(mkoani_diff_autocor, main = \"Spatial Autocorrelation of Changes\")\npar(mfrow = c(1, 1))\n```\n:::\n\n\n\n\n**Interpretation**:\n- **High positive Moran's I (green)**: Changes cluster spatially—improvements cluster with improvements, degradation with degradation (suggests shared drivers)\n- **Near-zero Moran's I (yellow)**: Random change patterns—no spatial clustering\n- **Negative Moran's I (magenta)**: Dispersed patterns—improvements surrounded by degradation\n\n### Structural Similarity Index (SSIM)\n\nSSIM combines luminance, contrast, and structure comparisons mimicking human perception of similarity:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(SSIMmap)\n\nmkoani_ssim = ssim_raster(mkoani_2020, mkoani_2023, global = FALSE, w = 5)\n\nplot_div(mkoani_ssim[[1]], \n         main = \"Local Structural Similarity\\n(1 = Identical, 0 = Completely Different)\")\n\n# Also get global SSIM\nssim_raster(mkoani_2020, mkoani_2023, global = TRUE)\n```\n:::\n\n\n\n\n**Interpretation**:\n- **SSIM = 0.85**: Overall ecosystem structure is very similar between years (2023 shows minor changes to 2020 baseline)\n- **SSIM = 0.50**: Moderate structural change (noticeable ecosystem transformation)\n- **SSIM < 0.30**: Substantial structural change (major ecosystem shifts)\n\n## Multi-Scale Analysis\n\nReal-world ecosystem processes operate across multiple spatial scales. Analyzing changes at multiple resolutions reveals scale-dependent patterns.\n\n### RMSE at Multiple Scales\n\nCompare ecosystem health at aggregated scales (50m, 100m, 150m windows):\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(waywiser)\n\n# Define scale progression\ncell_sizes = seq(50, 300, by = 50)\n\n# Calculate RMSE at multiple scales\nmkoani_multi_scale = waywiser::ww_multi_scale(\n  truth = mkoani_2020, \n  estimate = mkoani_2023,\n  metrics = list(yardstick::rmse), \n  cellsize = cell_sizes,\n  progress = FALSE\n)\n\n# View results\nmkoani_multi_scale\n```\n:::\n\n\n\n\n**Interpretation**:\nIf RMSE decreases from 0.20 (50m) to 0.15 (300m):\n- Fine-scale differences are greater (local heterogeneity)\n- Coarse-scale differences are smaller (regional homogeneity)\n- Management implication: Local-level interventions may be needed alongside regional strategies\n\n### MAD at Multiple Resolutions\n\nThe `MAD()` function from diffeR calculates Mean Absolute Difference at scales doubling each step:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(diffeR)\n\nmkoani_mad_multi = MAD(mkoani_2023, mkoani_2020, eval = \"multiple\")\n\n# Extract results\nmkoani_mad_results = mkoani_mad_multi$Total\nprint(mkoani_mad_results)\n```\n:::\n\n\n\n\n## Comparative Analysis: Mkoani vs Mkuranga\n\nCompare ecosystem health trajectories between the two districts:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmkuranga_2020 = rast(\"ecosystem_health_mkuranga_2020.tif\")\nmkuranga_2023 = rast(\"ecosystem_health_mkuranga_2023.tif\")\n\n# Calculate metrics for both regions\nmkoani_mad = MAD(mkoani_2023, mkoani_2020)$Total\nmkuranga_mad = MAD(mkuranga_2023, mkuranga_2020)$Total\n\ncomparison_table = data.frame(\n  Region = c(\"Mkoani\", \"Mkuranga\"),\n  MAD_2020_2023 = c(mkoani_mad, mkuranga_mad),\n  Direction = c(\n    if(mean(values(mkoani_2023), na.rm = TRUE) > mean(values(mkoani_2020), na.rm = TRUE)) \"Improving\" else \"Declining\",\n    if(mean(values(mkuranga_2023), na.rm = TRUE) > mean(values(mkuranga_2020), na.rm = TRUE)) \"Improving\" else \"Declining\"\n  )\n)\n\ncomparison_table\n```\n:::\n\n\n\n\n## Decision Framework: From Analysis to Action\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Example interpretation matrix for management decisions\ndecision_matrix = data.frame(\n  Pattern = c(\"Clustered improvements\", \"Clustered degradation\", \"Random changes\", \"Isolated hotspots\"),\n  Spatial_Autocor = c(\"High positive\", \"High positive\", \"Near zero\", \"Negative\"),\n  Management_Priority = c(\"Expand successful practices\", \"Urgent intervention zones\", \"Site-specific assessments\", \"Targeted restoration\"),\n  Timeframe = c(\"Medium-term\", \"Immediate\", \"Short-term\", \"Long-term\")\n)\n\ndecision_matrix\n```\n:::\n\n\n\n\n## Implementation Timeline for MSP\n\n**January 2026**: Final field validation surveys in Mkoani and Mkuranga\n- Collect ecosystem health observations at validation points (n=50 per site)\n- Correlate with raster-derived indices\n\n**February 2026**: Baseline-current comparison analysis\n- Calculate all difference metrics at both sites\n- Identify priority areas for intervention or conservation\n\n**March 2026**: Multi-scale spatial analysis\n- Evaluate changes at management-relevant scales (coastal zone, district, sub-district)\n- Develop scale-appropriate monitoring protocols\n\n**April 2026**: Integration with bio-economic analysis\n- Link spatial change patterns to economic implications\n- Develop evidence-based management recommendations\n\n## References\n\nCliff, Andrew D. 1970. \"Computing the Spatial Correspondence Between Geographical Patterns.\" *Transactions of the Institute of British Geographers*, no. 50: 143. https://doi.org/10.2307/621351\n\nHa, Hui Jeong, and Jed Long. 2023. \"SSIMmap: The Structural Similarity Index Measure for Maps.\" R Package Manual.\n\nHaralick, Robert M., Karthikeyan Shanmugam, and Itsak Dinstein. 1973. \"Textural Features for Image Classification.\" *IEEE Transactions on Systems, Man, and Cybernetics*, no. 6: 610–21.\n\nHijmans, Robert J. 2024. \"Terra: Spatial Data Analysis.\" R Package Manual.\n\nIlich, Alexander R. 2020. \"GLCMTextures.\" R Package. https://doi.org/10.5281/zenodo.3813252\n\nMahoney, Michael J. 2023. \"Waywiser: Ergonomic Methods for Assessing Spatial Models.\" R Package. https://github.com/mikemahoney218/waywiser\n\nNowosad, Jakub. 2024. \"Comparison of Spatial Patterns in Continuous Raster Data for Overlapping Regions Using R.\" *Thinking in Spatial Patterns* (blog), October 20, 2024. https://jakubnowosad.com/posts/2024-10-20-spatcomp-bp2/\n\nPontius Jr., Robert Gilmore, and Alberto Santacruz. 2023. \"diffeR: Quantifying Differences Between Maps.\" R Package.\n\nRao, C. Radhakrishnan. 1982. \"Diversity and Dissimilarity Coefficients: A Unified Approach.\" *Theoretical Population Biology*, 21(1): 24–43.\n\nRocchini, Duccio, et al. 2021. \"Rasterdiv: Information Theory Tailored R Package for Measuring Ecosystem Heterogeneity from Space.\" *Methods in Ecology and Evolution*, 12(6): 2195. https://doi.org/10.1111/2041-210X.13583\n\nSmith, Annie C., Phoebe Zarnetske, Kyla Dahlin, Adam Wilson, and Andrew Latimer. 2023. \"Geodiv: Methods for Calculating Gradient Surface Metrics.\" R Package Manual.\n\nWang, Zhaoqian, Alan C. Bovik, Hamid R. Sheikh, and Eero P. Simoncelli. 2004. \"Image Quality Assessment: From Error Visibility to Structural Similarity.\" *IEEE Transactions on Image Processing*, 13(4): 600–612. https://doi.org/10.1109/TIP.2003.819861\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}