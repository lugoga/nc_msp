<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Masumbuko Semba">
<meta name="author" content="Siajali Pamba">
<meta name="dcterms.date" content="2025-12-27">
<meta name="description" content="Using spatial pattern metrics to compare marine ecosystem structure and configuration between Mkoani-Pemba and Mkuranga-Pwani districts, revealing critical insights for conservation planning.">

<title>Comparing Marine Ecosystem Patterns: Mkoani and Mkuranga Districts</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-20cb7ac89268f2f6837cd43da0a0d99f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<meta name="description" content="Marine Spatial Planning Initiative for Tanzania - Spatial analysis, coastal management, and ecosystem monitoring in Mkoani and Mkuranga districts">
<meta name="keywords" content="marine spatial planning, coastal management, Tanzania, land cover analysis, ecosystem monitoring, Mkoani, Mkuranga, Pemba, Pwani">
<meta name="author" content="Masumbuko Semba, SOAF-UDSM">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta property="og:title" content="Comparing Marine Ecosystem Patterns: Mkoani and Mkuranga Districts">
<meta property="og:description" content="Using spatial pattern metrics to compare marine ecosystem structure and configuration between Mkoani-Pemba and Mkuranga-Pwani districts, revealing critical insights for conservation planning.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://lugoga.github.io/nc_msp/">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Comparing Marine Ecosystem Patterns: Mkoani and Mkuranga Districts">
<meta name="twitter:description" content="Using spatial pattern metrics to compare marine ecosystem structure and configuration between Mkoani-Pemba and Mkuranga-Pwani districts, revealing critical insights for conservation planning.">


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/coat_OG_web.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../about.html" aria-current="page"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../schedule.html"> 
<span class="menu-text">Scope</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-reports" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Reports</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-reports">    
        <li>
    <a class="dropdown-item" href="../../reports/UN_Inception report_14092025_SM.pdf" target="_blank">
 <span class="dropdown-text">Deliverable One: Inception Report</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-resources" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Resources</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-resources">    
        <li>
    <a class="dropdown-item" href="../../TOR_259658.pdf" target="_blank">
 <span class="dropdown-text">Resources1: TOR</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <span class="nav-link">
<span class="menu-text">WebApp</span>
    </span>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../team.html"> 
<span class="menu-text">Team</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../gallery.html"> 
<span class="menu-text">Gallery</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/lugoga/stock_training_somalia"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Comparing Marine Ecosystem Patterns: Mkoani and Mkuranga Districts</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Project Info</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About This Marine Spatial Planning Initiative</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../team.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Meet Our Team</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../news.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">News &amp; Updates</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Weather Updates</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weather.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Live Weather</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../news.html#current-conditions--field-operations" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seasonal Calendar</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.ncei.noaa.gov/products/ocean-weather-forecast" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">NOAA Marine Forecast</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://oceancurrents.rsmas.miami.edu/" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Ocean Current Maps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.tides.noaa.gov/" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Sea Level Information</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.nhc.noaa.gov/" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Tropical Storm Tracking</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#understanding-marine-spatial-diversity" id="toc-understanding-marine-spatial-diversity" class="nav-link active" data-scroll-target="#understanding-marine-spatial-diversity">Understanding Marine Spatial Diversity</a></li>
  <li><a href="#comparing-ecosystem-diversity-non-spatial-metrics" id="toc-comparing-ecosystem-diversity-non-spatial-metrics" class="nav-link" data-scroll-target="#comparing-ecosystem-diversity-non-spatial-metrics">Comparing Ecosystem Diversity: Non-Spatial Metrics</a></li>
  <li><a href="#analyzing-spatial-configuration-context-dependent-metrics" id="toc-analyzing-spatial-configuration-context-dependent-metrics" class="nav-link" data-scroll-target="#analyzing-spatial-configuration-context-dependent-metrics">Analyzing Spatial Configuration: Context-Dependent Metrics</a>
  <ul class="collapse">
  <li><a href="#spatial-signature-comparison" id="toc-spatial-signature-comparison" class="nav-link" data-scroll-target="#spatial-signature-comparison">Spatial Signature Comparison</a></li>
  </ul></li>
  <li><a href="#implications-for-marine-spatial-planning" id="toc-implications-for-marine-spatial-planning" class="nav-link" data-scroll-target="#implications-for-marine-spatial-planning">Implications for Marine Spatial Planning</a>
  <ul class="collapse">
  <li><a href="#connectivity-and-restoration-priorities" id="toc-connectivity-and-restoration-priorities" class="nav-link" data-scroll-target="#connectivity-and-restoration-priorities">1. <strong>Connectivity and Restoration Priorities</strong></a></li>
  <li><a href="#ecosystem-service-provision" id="toc-ecosystem-service-provision" class="nav-link" data-scroll-target="#ecosystem-service-provision">2. <strong>Ecosystem Service Provision</strong></a></li>
  <li><a href="#climate-resilience" id="toc-climate-resilience" class="nav-link" data-scroll-target="#climate-resilience">3. <strong>Climate Resilience</strong></a></li>
  <li><a href="#management-unit-design" id="toc-management-unit-design" class="nav-link" data-scroll-target="#management-unit-design">4. <strong>Management Unit Design</strong></a></li>
  </ul></li>
  <li><a href="#data-requirements-and-next-steps" id="toc-data-requirements-and-next-steps" class="nav-link" data-scroll-target="#data-requirements-and-next-steps">Data Requirements and Next Steps</a></li>
  <li><a href="#bringing-it-together-from-metrics-to-management" id="toc-bringing-it-together-from-metrics-to-management" class="nav-link" data-scroll-target="#bringing-it-together-from-metrics-to-management">Bringing It Together: From Metrics to Management</a></li>
  <li><a href="#conclusion-spatial-patterns-as-a-foundation-for-planning" id="toc-conclusion-spatial-patterns-as-a-foundation-for-planning" class="nav-link" data-scroll-target="#conclusion-spatial-patterns-as-a-foundation-for-planning">Conclusion: Spatial Patterns as a Foundation for Planning</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Comparing Marine Ecosystem Patterns: Mkoani and Mkuranga Districts</h1>
  <div class="quarto-categories">
    <div class="quarto-category">marine spatial planning</div>
    <div class="quarto-category">ecosystem analysis</div>
    <div class="quarto-category">geospatial mapping</div>
    <div class="quarto-category">biodiversity</div>
  </div>
  </div>

<div>
  <div class="description">
    Using spatial pattern metrics to compare marine ecosystem structure and configuration between Mkoani-Pemba and Mkuranga-Pwani districts, revealing critical insights for conservation planning.
  </div>
</div>

<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Masumbuko Semba </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Nelson Mandela African Institution of Science and Technology
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Siajali Pamba </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Dar es Salaam, School of Aquatic Sciences and Fisheries Technology
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 27, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="understanding-marine-spatial-diversity" class="level2">
<h2 class="anchored" data-anchor-id="understanding-marine-spatial-diversity">Understanding Marine Spatial Diversity</h2>
<p>Effective marine spatial planning requires more than just identifying where different ecosystems exist—it requires understanding how they are arranged, how fragmented they are, and how their spatial configurations affect ecological function and management options. This post explores methods for comparing spatial patterns in marine ecosystem data across Mkoani (Pemba) and Mkuranga (Pwani Region) districts using quantitative landscape metrics.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph TD
    A["&lt;b&gt;MARINE ECOSYSTEM MAP&lt;/b&gt;&lt;br/&gt;Mangroves | Seagrass | Coral | Beach"]
    
    B["&lt;b&gt;SPATIAL PATTERN ANALYSIS&lt;/b&gt;&lt;br/&gt;Fragmentation | Diversity | Complexity"]
    C["&lt;b&gt;LANDSCAPE METRICS&lt;/b&gt;&lt;br/&gt;Shannon Index | Edge Density | Zhao's Entropy"]
    D["&lt;b&gt;COMPARATIVE ANALYSIS&lt;/b&gt;&lt;br/&gt;Mkoani vs. Mkuranga&lt;br/&gt;Temporal Trends"]
    E["&lt;b&gt;CONSERVATION INSIGHTS&lt;/b&gt;&lt;br/&gt;Restoration Priorities | Connectivity Zones"]
    F["&lt;b&gt;MANAGEMENT STRATEGY&lt;/b&gt;&lt;br/&gt;Protected Areas | Restoration Plans | Blue Carbon"]
    
    A --&gt;|Geospatial&lt;br/&gt;Classification| B
    B --&gt;|Quantify&lt;br/&gt;Patterns| C
    C --&gt;|Compare&lt;br/&gt;Districts| D
    D --&gt;|Interpret&lt;br/&gt;Results| E
    E --&gt;|Design&lt;br/&gt;Strategies| F
    F --&gt;|Implementation| A
    
    style A fill:#e0f2f1
    style B fill:#b3e5fc
    style C fill:#81d4fa
    style D fill:#4fc3f7
    style E fill:#29b6f6
    style F fill:#03a9f4
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>Understanding spatial patterns in marine ecosystems allows us to identify critical conservation areas, restoration opportunities, and functional connectivity zones essential for sustainable management.</p>
</section>
<section id="comparing-ecosystem-diversity-non-spatial-metrics" class="level2">
<h2 class="anchored" data-anchor-id="comparing-ecosystem-diversity-non-spatial-metrics">Comparing Ecosystem Diversity: Non-Spatial Metrics</h2>
<p>One approach to comparing marine ecosystem patterns between Mkoani and Mkuranga is to use landscape metrics that quantify diversity based on the proportion and types of ecosystems present, independent of their spatial arrangement.</p>
<p><strong>Shannon Diversity Index (SHDI)</strong> is a standard measure where higher values indicate greater ecosystem diversity. For our coastal districts:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(landscapemetrics)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Shannon diversity for Mkoani mangrove ecosystems</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>mkoani_shdi <span class="ot">=</span> <span class="fu">lsm_l_shdi</span>(mkoani_ecosystem_map)  <span class="co"># Example: 1.52</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Shannon diversity for Mkuranga mangrove ecosystems</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>mkuranga_shdi <span class="ot">=</span> <span class="fu">lsm_l_shdi</span>(mkuranga_ecosystem_map)  <span class="co"># Example: 1.38</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare diversity</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>diversity_difference <span class="ot">=</span> <span class="fu">abs</span>(mkoani_shdi<span class="sc">$</span>value <span class="sc">-</span> mkuranga_shdi<span class="sc">$</span>value)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: 0.14 - Mkoani shows slightly higher ecosystem diversity</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>What this tells us:</strong></p>
<ul>
<li>Mkoani’s ecosystem composition includes a more diverse mix of mangroves, seagrass beds, and coral patches</li>
<li>Mkuranga’s ecosystems are somewhat less diverse, possibly dominated by a few key habitat types</li>
<li>These differences suggest different management approaches may be needed for conservation and restoration</li>
</ul>
<p>This non-spatial analysis reveals what ecosystems are present, but not how they are arranged—an equally important consideration for connectivity and resilience.</p>
</section>
<section id="analyzing-spatial-configuration-context-dependent-metrics" class="level2">
<h2 class="anchored" data-anchor-id="analyzing-spatial-configuration-context-dependent-metrics">Analyzing Spatial Configuration: Context-Dependent Metrics</h2>
<p>While Shannon diversity tells us about ecosystem types present, <strong>Edge Density (ED)</strong> and <strong>Zhao’s Entropy</strong> reveal how fragmented or complex the spatial arrangement is.</p>
<p><strong>Edge Density</strong> measures the length of borders between different ecosystem types. Higher ED values indicate a more fragmented landscape:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate edge density for Mkoani</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>mkoani_ed <span class="ot">=</span> <span class="fu">lsm_l_ed</span>(mkoani_ecosystem_map)  <span class="co"># Example: 28.3 m/ha</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate edge density for Mkuranga</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>mkuranga_ed <span class="ot">=</span> <span class="fu">lsm_l_ed</span>(mkuranga_ecosystem_map)  <span class="co"># Example: 22.1 m/ha</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare fragmentation</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>fragmentation_diff <span class="ot">=</span> <span class="fu">abs</span>(mkoani_ed<span class="sc">$</span>value <span class="sc">-</span> mkuranga_ed<span class="sc">$</span>value)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: 6.2 m/ha - Mkoani ecosystems are more fragmented</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Zhao’s Entropy</strong> quantifies overall landscape complexity, considering both diversity and spatial arrangement:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bespatial)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>mkoani_entropy <span class="ot">=</span> <span class="fu">bes_m_zhao</span>(mkoani_ecosystem_map)  <span class="co"># Example: 0.0428</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>mkuranga_entropy <span class="ot">=</span> <span class="fu">bes_m_zhao</span>(mkuranga_ecosystem_map)  <span class="co"># Example: 0.0391</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>complexity_diff <span class="ot">=</span> <span class="fu">abs</span>(mkoani_entropy<span class="sc">$</span>value <span class="sc">-</span> mkuranga_entropy<span class="sc">$</span>value)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: 0.0037 - Mkoani shows higher landscape complexity</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Interpretation for Management:</strong></p>
<ul>
<li><strong>Mkoani</strong> has higher fragmentation and complexity, suggesting:
<ul>
<li>More isolated patches of mangrove, seagrass, and coral</li>
<li>Greater need for connectivity restoration measures</li>
<li>Opportunity for strategic habitat corridors</li>
<li>Potential vulnerability to ecosystem isolation</li>
</ul></li>
<li><strong>Mkuranga</strong> has lower fragmentation, suggesting:
<ul>
<li>More cohesive ecosystem blocks</li>
<li>Better natural connectivity between habitat types</li>
<li>Different restoration focus on patch quality rather than connectivity</li>
<li>Potential for different sustainable use strategies</li>
</ul></li>
</ul>
<section id="spatial-signature-comparison" class="level3">
<h3 class="anchored" data-anchor-id="spatial-signature-comparison">Spatial Signature Comparison</h3>
<p>An advanced approach uses <strong>co-occurrence vectors</strong> to create a “spatial signature” of each ecosystem—a fingerprint of how different habitat types are arranged relative to each other:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(motif)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(philentropy)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create spatial signatures based on ecosystem adjacencies</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>mkoani_sig <span class="ot">=</span> <span class="fu">lsp_signature</span>(mkoani_ecosystem_map, <span class="at">type =</span> <span class="st">"cove"</span>, <span class="at">threshold =</span> <span class="dv">1</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>mkuranga_sig <span class="ot">=</span> <span class="fu">lsp_signature</span>(mkuranga_ecosystem_map, <span class="at">type =</span> <span class="st">"cove"</span>, <span class="at">threshold =</span> <span class="dv">1</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare signatures using Jensen-Shannon divergence</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># (Lower values = more similar patterns)</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>pattern_similarity <span class="ot">=</span> <span class="fu">jensen_shannon</span>(mkoani_sig<span class="sc">$</span>signature[[<span class="dv">1</span>]],</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                                   mkuranga_sig<span class="sc">$</span>signature[[<span class="dv">1</span>]], </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">testNA =</span> <span class="cn">FALSE</span>, <span class="at">unit =</span> <span class="st">"log2"</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: 0.087 - Moderate dissimilarity in spatial arrangement</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This analysis reveals that while Mkoani and Mkuranga share some ecosystem types, their spatial arrangement is substantially different—requiring tailored conservation strategies for each site.</p>
</section>
</section>
<section id="implications-for-marine-spatial-planning" class="level2">
<h2 class="anchored" data-anchor-id="implications-for-marine-spatial-planning">Implications for Marine Spatial Planning</h2>
<p>These quantitative comparisons of spatial patterns in marine ecosystem data yield critical insights for planning:</p>
<section id="connectivity-and-restoration-priorities" class="level3">
<h3 class="anchored" data-anchor-id="connectivity-and-restoration-priorities">1. <strong>Connectivity and Restoration Priorities</strong></h3>
<p>Mkoani’s higher fragmentation suggests that restoration efforts should focus on: - Creating corridors between isolated mangrove patches - Restoring seagrass connectivity between reef and coastal zones - Establishing stepping-stone habitats for fish migration - Identifying and protecting critical linking areas</p>
<p>Mkuranga’s lower fragmentation allows for different strategies: - Focus on patch quality and habitat health - Maintain existing connectivity - Identify nodes for intensive protection (marine parks) - Plan for sustainable extraction with connectivity in mind</p>
</section>
<section id="ecosystem-service-provision" class="level3">
<h3 class="anchored" data-anchor-id="ecosystem-service-provision">2. <strong>Ecosystem Service Provision</strong></h3>
<p>Landscape fragmentation directly affects ecosystem services:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 72%">
</colgroup>
<thead>
<tr class="header">
<th>Service</th>
<th>Impact of Fragmentation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Fish recruitment</strong></td>
<td>Fragmented habitats = reduced larval connectivity</td>
</tr>
<tr class="even">
<td><strong>Carbon sequestration</strong></td>
<td>Dispersed mangroves = less carbon stock aggregation</td>
</tr>
<tr class="odd">
<td><strong>Shoreline protection</strong></td>
<td>Isolated patches = gaps in storm surge buffering</td>
</tr>
<tr class="even">
<td><strong>Biodiversity support</strong></td>
<td>Fragmented habitat = isolation effects on species</td>
</tr>
</tbody>
</table>
</section>
<section id="climate-resilience" class="level3">
<h3 class="anchored" data-anchor-id="climate-resilience">3. <strong>Climate Resilience</strong></h3>
<p>Landscape complexity and connectivity determine resilience to climate change:</p>
<ul>
<li><strong>More fragmented</strong> (Mkoani): Greater vulnerability to localized disturbances; lower climate resilience</li>
<li><strong>More connected</strong> (Mkuranga): Better ability to maintain function if some patches degrade</li>
</ul>
<p>This suggests different vulnerability assessments and adaptation strategies for each district.</p>
</section>
<section id="management-unit-design" class="level3">
<h3 class="anchored" data-anchor-id="management-unit-design">4. <strong>Management Unit Design</strong></h3>
<p>The spatial pattern analysis helps define appropriate management units:</p>
<ul>
<li><strong>Mkoani</strong>: May need smaller, intensively managed zones given fragmentation</li>
<li><strong>Mkuranga</strong>: Can support larger management units leveraging natural connectivity</li>
</ul>
</section>
</section>
<section id="data-requirements-and-next-steps" class="level2">
<h2 class="anchored" data-anchor-id="data-requirements-and-next-steps">Data Requirements and Next Steps</h2>
<p>Conducting this analysis requires:</p>
<p><strong>Geospatial Data:</strong> - High-resolution ecosystem classification maps (e.g., from Landsat, Sentinel, or ground surveys) - Habitat boundaries for mangroves, seagrass, coral, and beaches - Updated maps for temporal comparison (identifying change over time)</p>
<p><strong>Implementation Timeline:</strong> - Field surveys to validate ecosystem boundaries: January - February 2026 - Spatial data processing and metric calculation: March 2026 - Stakeholder presentation of findings: 28 February 2026 (validation meeting) - Integration into spatial planning outputs: March - April 2026</p>
<p><strong>Tools and Methods:</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Key packages for this analysis</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)          <span class="co"># Raster data handling</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(landscapemetrics)  <span class="co"># Landscape metrics</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bespatial)      <span class="co"># Complexity measures</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(motif)          <span class="co"># Spatial signatures</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(philentropy)    <span class="co"># Distance measures</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="bringing-it-together-from-metrics-to-management" class="level2">
<h2 class="anchored" data-anchor-id="bringing-it-together-from-metrics-to-management">Bringing It Together: From Metrics to Management</h2>
<p>Quantitative spatial pattern analysis transforms raw geospatial data into actionable management information:</p>
<ol type="1">
<li><strong>Identify</strong> the specific spatial challenges in each district</li>
<li><strong>Design</strong> context-appropriate conservation and restoration strategies</li>
<li><strong>Monitor</strong> changes in spatial patterns over time</li>
<li><strong>Adapt</strong> management based on pattern dynamics</li>
</ol>
<p>Rather than applying a one-size-fits-all marine spatial plan, this approach ensures that Mkoani and Mkuranga receive management strategies tailored to their unique ecosystem configurations and challenges.</p>
</section>
<section id="conclusion-spatial-patterns-as-a-foundation-for-planning" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-spatial-patterns-as-a-foundation-for-planning">Conclusion: Spatial Patterns as a Foundation for Planning</h2>
<p>Understanding and comparing spatial patterns in marine ecosystem data is not merely an academic exercise—it’s essential groundwork for effective marine spatial planning. By quantifying how ecosystems are arranged, we move from subjective observations to objective, measurable metrics that support evidence-based management decisions.</p>
<p>For Mkoani and Mkuranga, these analyses reveal that while both districts contain critical marine ecosystems, their spatial organization demands different management approaches. The tools and methods presented here will support the marine spatial planning team in designing conservation and sustainable use strategies tailored to each district’s unique ecological structure.</p>
<hr>
<p><strong>References:</strong></p>
<ul>
<li>Hesselbarth, M. H., Sciaini, M., With, K. A., Wiegand, K., &amp; Nowosad, J. (2019). landscapemetrics: An open-source R tool to calculate landscape metrics. Ecography, 42(10), 1648–1657.</li>
<li>Nowosad, J. (2024). Comparison of spatial patterns in categorical raster data for arbitrary regions using R. https://jakubnowosad.com/posts/2024-11-10-spatcomp-bp5/</li>
<li>Jasiewicz, J., &amp; Stepinski, T. F. (2013). Example-based retrieval of alike land-cover scenes from NLCD2006 database. IEEE Geoscience and Remote Sensing Letters, 10(1), 155–159.</li>
</ul>
<p><strong>Data &amp; Methods:</strong></p>
<p>All analyses use open-source R packages and publicly available geospatial data sources (ESA, NAFORMA, ground surveys) integrated into the Marine Spatial Planning project’s geospatial database for Mkoani and Mkuranga districts.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>© 2025 Semba | Marine Spatial Planning | Led by <a href="https://www.udsm.ac.tz">SOAF-UDSM</a> | <a href="mailto:msp.coastal.tz@udsm.ac.tz">Contact Us</a></p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>