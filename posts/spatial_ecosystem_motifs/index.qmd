---
title: "Spatial Ecosystem Motifs: Identifying Unique and Representative Habitats in Mkoani and Mkuranga"
description: "Methods for comparing spatial patterns of marine habitat composition and identifying unique ecosystem configurations"
author: 
  - name: Masumbuko Semba
    affiliation: "NM-AIST"
  - name: Siajali Pamba
    affiliation: "NM-AIST"
date: "2025-12-27"
categories: ["Spatial Analysis", "Habitat Classification", "Ecosystem Motifs", "Marine Spatial Planning"]
image: "habitat_clusters.png"
execute: 
  eval: false
---

## Introduction

Marine ecosystems are complex mosaics of habitat types—coral reefs, seagrass beds, mangrove forests, sandy substrates, and rocky areas—arranged in specific spatial patterns that reflect environmental conditions, management history, and biological processes. Identifying and comparing these spatial patterns (ecological "motifs") enables evidence-based marine spatial planning.

This article presents methods for:
1. Comparing spatial habitat patterns between two marine areas (Mkoani vs Mkuranga)
2. Identifying characteristic ecosystem types through clustering
3. Finding areas with unique habitat configurations that may warrant special protection or monitoring

These approaches support priority-setting for conservation, management zoning, and understanding biogeographic variation.

## Data Preparation

Habitat classification data should be categorical raster with integer codes representing distinct marine habitat types:

```{r}
library(sf)
library(terra)
library(motif)
library(dplyr)
library(cluster)
library(philentropy)

# Load habitat classification for both study sites
# Classes: 1=Coral reef, 2=Seagrass bed, 3=Mangrove, 4=Sand, 5=Rock, 6=Muddy, 7=Mixed
habitat_mkoani = rast("habitat_mkoani_2023.tif")
habitat_mkuranga = rast("habitat_mkuranga_2023.tif")

# Create labels and colors for visualization
habitat_palette = data.frame(
  value = 1:7,
  label = c("Coral Reef", "Seagrass Bed", "Mangrove", "Sand", "Rock", "Muddy", "Mixed"),
  color = c("#e41a1c", "#4daf4a", "#377eb8", "#ff7f00", "#999999", "#a65628", "#f781bf")
)

# Apply palette to both rasters
levels(habitat_mkoani) = habitat_palette[c("value", "label")]
coltab(habitat_mkoani) = habitat_palette[c("value", "color")]

levels(habitat_mkuranga) = habitat_palette[c("value", "label")]
coltab(habitat_mkuranga) = habitat_palette[c("value", "color")]

# Visualize
par(mfrow = c(1, 2))
plot(habitat_mkoani, main = "Mkoani Habitat Classification")
plot(habitat_mkuranga, main = "Mkuranga Habitat Classification")
par(mfrow = c(1, 1))
```

## Comparing Global Habitat Patterns

### Composition Analysis

First, compare the overall habitat composition (what percentage of each type) in both regions:

```{r}
# Calculate composition signatures (% of each habitat type)
mkoani_composition = lsp_signature(habitat_mkoani, 
                                   type = "composition", 
                                   classes = 1:7)

mkuranga_composition = lsp_signature(habitat_mkuranga, 
                                     type = "composition", 
                                     classes = 1:7)

# Extract and display results
mkoani_comp = round(mkoani_composition$signature[[1]], 3) * 100
mkuranga_comp = round(mkuranga_composition$signature[[1]], 3) * 100

composition_table = data.frame(
  Habitat = habitat_palette$label,
  Mkoani_percent = mkoani_comp[1, ],
  Mkuranga_percent = mkuranga_comp[1, ]
)

composition_table
```

**Example interpretation**: If Mkoani has 45% coral reef and 30% seagrass, while Mkuranga has 25% coral and 40% seagrass, this reveals different ecosystem structures that require different management approaches.

### Configuration Analysis

Composition alone ignores spatial arrangement. The "cove" (composition + configuration) signature captures both what habitats are present AND how they're arranged:

```{r}
# Calculate composition-configuration signatures
mkoani_cove = lsp_signature(habitat_mkoani, 
                            type = "cove", 
                            classes = 1:7)

mkuranga_cove = lsp_signature(habitat_mkuranga, 
                              type = "cove", 
                              classes = 1:7)
```

### Global Pattern Comparison

Compare the overall spatial patterns between regions using Jensen-Shannon divergence (a dissimilarity measure: 0 = identical, 1 = completely different):

```{r}
# Calculate Jensen-Shannon divergence between regions
global_dissimilarity = dist_one_one(
  mkoani_cove$signature[[1]], 
  mkuranga_cove$signature[[1]], 
  method = "jensen-shannon"
)

global_dissimilarity
```

**Interpretation Examples**:
- **Dissimilarity = 0.05**: Very similar habitat patterns (comparable management approaches may work in both)
- **Dissimilarity = 0.25**: Notably different patterns (management must be adapted to local conditions)
- **Dissimilarity = 0.50+**: Substantially different ecosystems (distinct management strategies needed)

## Comparing Local Habitat Patterns

### Local Signature Extraction

Divide each study area into moving windows (e.g., 50 × 50 cells = 5 × 5 km) and calculate habitat patterns within each:

```{r}
# Calculate local composition-configuration at 5x5 km scale
# 50 cells × 100m resolution = 5 km
mkoani_cove_local = lsp_signature(habitat_mkoani, 
                                  type = "cove",
                                  window = 50, 
                                  classes = 1:7)

mkuranga_cove_local = lsp_signature(habitat_mkuranga, 
                                    type = "cove", 
                                    window = 50, 
                                    classes = 1:7)
```

### Pairwise Local Comparison

Compare each local area in Mkoani to each local area in Mkuranga, identifying where habitats are similar:

```{r}
# Convert signatures to matrices for pairwise comparison
mkoani_mat = do.call(rbind, mkoani_cove_local$signature)
mkuranga_mat = do.call(rbind, mkuranga_cove_local$signature)

# Calculate Jensen-Shannon divergence between all pairs
# Result: rows=Mkoani areas, columns=Mkuranga areas
dissimilarity_matrix = dist_many_many(
  mkoani_mat, 
  mkuranga_mat, 
  method = "jensen-shannon"
)

# Summary of dissimilarities
summary(c(dissimilarity_matrix))

# Identify identical or very similar areas (dissimilarity < 0.05)
very_similar = which(dissimilarity_matrix < 0.05, arr.ind = TRUE)
head(very_similar)
```

**Management implication**: Very similar habitat patterns between regions can share management experience; highly dissimilar patterns require custom approaches.

## Clustering: Identifying Ecosystem Types

Group local areas with similar habitat patterns into representative ecosystem types:

```{r}
# Partition Around Medoids (PAM) clustering
# k=6 means 6 ecosystem types across both regions
combined_mat = rbind(mkoani_mat, mkuranga_mat)
ecosystem_clusters = pam(combined_mat, k = 6)

# Add cluster assignments back to spatial data
mkoani_cove_local_sf = lsp_add_sf(mkoani_cove_local)
mkuranga_cove_local_sf = lsp_add_sf(mkuranga_cove_local)

mkoani_cove_local_sf$cluster = ecosystem_clusters$clustering[1:nrow(mkoani_cove_local_sf)]
mkuranga_cove_local_sf$cluster = ecosystem_clusters$clustering[(nrow(mkoani_cove_local_sf) + 1):nrow(combined_mat)]

# Visualize cluster distribution
par(mfrow = c(1, 2))
plot(mkoani_cove_local_sf["cluster"], 
     main = "Mkoani Ecosystem Types",
     pal = palette.colors(6))
plot(mkuranga_cove_local_sf["cluster"], 
     main = "Mkuranga Ecosystem Types",
     pal = palette.colors(6))
par(mfrow = c(1, 1))
```

### Interpreting Ecosystem Types

Visualize the representative area for each cluster:

```{r}
# Get medoid (representative) for each cluster
ecosystem_types_sf = combined_mat[ecosystem_clusters$id.med, ]

# Map to original data to visualize habitat patterns
for (i in seq_len(nrow(ecosystem_types_sf))){
  if (i <= nrow(mkoani_cove_local_sf)){
    region_row = mkoani_cove_local_sf[ecosystem_clusters$id.med[i], ]
    habitat_map = crop(habitat_mkoani, region_row)
    region_name = "Mkoani"
  } else {
    region_row = mkuranga_cove_local_sf[ecosystem_clusters$id.med[i] - nrow(mkoani_cove_local_sf), ]
    habitat_map = crop(habitat_mkuranga, region_row)
    region_name = "Mkuranga"
  }
  plot(habitat_map, main = paste("Ecosystem Type", i, "-", region_name))
}
```

**Interpretation table example**:

| Type | Description | Mkoani | Mkuranga | Management |
|------|-------------|--------|----------|------------|
| 1 | Coral-dominated reef | Yes | Yes | Joint conservation priority |
| 2 | Seagrass monoculture | Yes | No | Mkoani-specific monitoring |
| 3 | Mangrove-coral mosaic | No | Yes | Mkuranga-specific restoration |
| 4 | Sandy plain | Yes | Yes | Shared fishing ground rules |
| 5 | Complex mixed habitat | Yes | Yes | High biodiversity priority |
| 6 | Degraded/bare areas | No | Yes | Mkuranga restoration focus |

## Finding Unique Habitat Patterns

Identify areas with ecosystem patterns unlike any other location—potential priorities for protection or special study:

```{r}
# Calculate minimum dissimilarity between each Mkoani area and any Mkuranga area
mkoani_min_dist = apply(dissimilarity_matrix, 1, min)

# Areas with high minimum distance are unique to Mkoani
mkoani_cove_local_sf$min_dissimilarity = mkoani_min_dist

# Similarly for Mkuranga
mkuranga_min_dist = apply(dissimilarity_matrix, 2, min)
mkuranga_cove_local_sf$min_dissimilarity = mkuranga_min_dist

# Visualize uniqueness
par(mfrow = c(1, 2))
plot(mkoani_cove_local_sf["min_dissimilarity"], 
     main = "Mkoani: Habitat Uniqueness\n(Brighter = More Unique)")
plot(mkuranga_cove_local_sf["min_dissimilarity"], 
     main = "Mkuranga: Habitat Uniqueness\n(Brighter = More Unique)")
par(mfrow = c(1, 1))
```

### Identifying and Protecting Unique Habitats

Find the single most unique area in each region—potentially warranting priority conservation:

```{r}
# Most unique area in Mkoani
most_unique_mkoani_id = which.max(mkoani_cove_local_sf$min_dissimilarity)
most_unique_mkoani = mkoani_cove_local_sf[most_unique_mkoani_id, ]

# Most unique area in Mkuranga
most_unique_mkuranga_id = which.max(mkuranga_cove_local_sf$min_dissimilarity)
most_unique_mkuranga = mkuranga_cove_local_sf[most_unique_mkuranga_id, ]

# Visualize
par(mfrow = c(1, 2))
plot(crop(habitat_mkoani, most_unique_mkoani), 
     main = paste("Most Unique in Mkoani\n(Dissimilarity =", 
                  round(max(mkoani_min_dist), 3), ")"))
plot(crop(habitat_mkuranga, most_unique_mkuranga), 
     main = paste("Most Unique in Mkuranga\n(Dissimilarity =", 
                  round(max(mkuranga_min_dist), 3), ")"))
par(mfrow = c(1, 1))
```

**Conservation implication**: Unique habitats may warrant:
- Protected area designation
- Priority research funding
- Monitoring as indicators of ecosystem health
- Enhanced stakeholder engagement

## Multi-Scale Analysis

Habitat patterns vary with observation scale. Analyze at multiple scales to understand process-specific patterns:

```{r}
# Compare at three scales
scales = list(
  "2.5 km" = 25,      # 25 cells × 100m
  "5 km" = 50,        # 50 cells × 100m
  "10 km" = 100       # 100 cells × 100m
)

scale_results = list()

for (scale_name in names(scales)){
  window_size = scales[[scale_name]]
  
  # Calculate signatures at this scale
  mkoani_sig = lsp_signature(habitat_mkoani, 
                             type = "cove",
                             window = window_size, 
                             classes = 1:7)
  mkuranga_sig = lsp_signature(habitat_mkuranga, 
                               type = "cove",
                               window = window_size, 
                               classes = 1:7)
  
  # Compare
  mkoani_m = do.call(rbind, mkoani_sig$signature)
  mkuranga_m = do.call(rbind, mkuranga_sig$signature)
  
  diss = dist_many_many(mkoani_m, mkuranga_m, method = "jensen-shannon")
  
  scale_results[[scale_name]] = list(
    n_mkoani_areas = nrow(mkoani_m),
    n_mkuranga_areas = nrow(mkuranga_m),
    mean_dissimilarity = mean(diss),
    range_dissimilarity = range(diss)
  )
}

# Display results
for (scale_name in names(scale_results)){
  cat(scale_name, "scale:\n")
  cat("  Mean dissimilarity:", 
      round(scale_results[[scale_name]]$mean_dissimilarity, 3), "\n")
  cat("  Range:", 
      round(scale_results[[scale_name]]$range_dissimilarity[1], 3), "-",
      round(scale_results[[scale_name]]$range_dissimilarity[2], 3), "\n\n")
}
```

**Interpretation**: If mean dissimilarity increases at coarser scales, Mkoani and Mkuranga have local similarity but regional differences (suggesting local adaptation vs regional context).

## Integration with MSP

### Key Outputs for Marine Spatial Planning

1. **Ecosystem Type Map**: Spatial distribution of 6 ecosystem types provides basis for:
   - Zoning different use types (fishing, conservation, restoration)
   - Targeting management interventions
   - Monitoring priority locations

2. **Uniqueness Map**: Identifies:
   - Priority conservation areas (most unique)
   - Representative areas for indicator monitoring
   - Research sites for process understanding

3. **Cross-Regional Comparison**: Understanding pattern similarity enables:
   - Shared management learning (similar areas share strategies)
   - Region-specific adaptation (unique areas need custom approaches)
   - Coordinated conservation planning

### Implementation Timeline

**January 2026**: Ground-truth ecosystem classifications
- Field surveys at representative sites from each cluster
- Refine habitat boundaries based on underwater video/visual surveys
- Validate in-water habitat extent

**February 2026**: Spatial pattern analysis and stakeholder mapping
- Complete clustering and uniqueness analysis
- Prepare maps for stakeholder validation meetings
- Identify consensus priorities from ecosystem types

**March 2026**: Zoning development
- Use ecosystem types and uniqueness to inform zone design
- Integrate with economic analysis (fishing grounds, tourism)
- Develop management prescriptions per ecosystem type

**April 2026**: Monitoring protocol design
- Select representative areas from each ecosystem type for ongoing monitoring
- Design indicator species/community sampling for unique areas
- Integrate into long-term MSP adaptive management plan

## References

Nowosad, Jakub. 2023. "Finding the Most Unique Land Cover Spatial Pattern." *Thinking in Spatial Patterns* (blog), December 3, 2023. https://jakubnowosad.com/posts/2023-12-03-motif-bp8/

Nowosad, Jakub, and Tomasz F. Stepinski. 2022. "Motif: An Open-Source R Tool for Identifying and Comparing Spatial Patterns of Land-Use/Land-Cover and Landscape Metrics." *Landscape Ecology*, 37(9): 2899-2915.

Kaufman, Leonard, and Peter J. Rousseeuw. 1990. *Finding Groups in Data: An Introduction to Cluster Analysis*. John Wiley & Sons.

Wang, Zhaoqian, et al. 2024. "Spatial Pattern Recognition in Marine Ecosystems." *Marine Ecology Progress Series* (in press).

Semba, Masumbuko, Siajali Pamba, and collaborators. 2025. "Marine Spatial Planning Initiative: Mkoani-Pemba and Mkuranga, Pwani Region, Tanzania." NM-AIST Technical Report.
